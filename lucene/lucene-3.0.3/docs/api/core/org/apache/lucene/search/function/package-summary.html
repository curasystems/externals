<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.5.0_22) on Sun Nov 28 19:10:44 MET 2010 -->
<META http-equiv="Content-Type" content="text/html; charset=utf-8">
<TITLE>
org.apache.lucene.search.function (Lucene 3.0.3 API)
</TITLE>

<META NAME="keywords" CONTENT="org.apache.lucene.search.function package">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    parent.document.title="org.apache.lucene.search.function (Lucene 3.0.3 API)";
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Package</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Class</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-use.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../../org/apache/lucene/search/package-summary.html"><B>PREV PACKAGE</B></A>&nbsp;
&nbsp;<A HREF="../../../../../org/apache/lucene/search/payloads/package-summary.html"><B>NEXT PACKAGE</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../../index.html?org/apache/lucene/search/function/package-summary.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="package-summary.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<H2>
Package org.apache.lucene.search.function
</H2>
<DIV>
  Programmatic control over documents scores.
<P>
<B>See:</B>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#package_description"><B>Description</B></A>
<P>

<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Class Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/ByteFieldSource.html" title="class in org.apache.lucene.search.function">ByteFieldSource</A></B></TD>
<TD>Expert: obtains single byte field values from the 
 <A HREF="../../../../../org/apache/lucene/search/FieldCache.html" title="interface in org.apache.lucene.search"><CODE>FieldCache</CODE></A>
 using <code>getBytes()</code> and makes those values 
 available as other numeric types, casting as needed.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/CustomScoreProvider.html" title="class in org.apache.lucene.search.function">CustomScoreProvider</A></B></TD>
<TD>An instance of this subclass should be returned by
 <A HREF="../../../../../org/apache/lucene/search/function/CustomScoreQuery.html#getCustomScoreProvider(org.apache.lucene.index.IndexReader)"><CODE>CustomScoreQuery.getCustomScoreProvider(org.apache.lucene.index.IndexReader)</CODE></A>, if you want
 to modify the custom score calculation of a <A HREF="../../../../../org/apache/lucene/search/function/CustomScoreQuery.html" title="class in org.apache.lucene.search.function"><CODE>CustomScoreQuery</CODE></A>.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/CustomScoreQuery.html" title="class in org.apache.lucene.search.function">CustomScoreQuery</A></B></TD>
<TD>Query that sets document score as a programmatic function of several (sub) scores:
 
    the score of its subQuery (any query)
    (optional) the score of its ValueSourceQuery (or queries).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/DocValues.html" title="class in org.apache.lucene.search.function">DocValues</A></B></TD>
<TD>Expert: represents field values as different types.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/FieldCacheSource.html" title="class in org.apache.lucene.search.function">FieldCacheSource</A></B></TD>
<TD>Expert: A base class for ValueSource implementations that retrieve values for
 a single field from the <A HREF="../../../../../org/apache/lucene/search/FieldCache.html" title="interface in org.apache.lucene.search"><CODE>FieldCache</CODE></A>.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/FieldScoreQuery.html" title="class in org.apache.lucene.search.function">FieldScoreQuery</A></B></TD>
<TD>A query that scores each document as the value of the numeric input field.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/FieldScoreQuery.Type.html" title="class in org.apache.lucene.search.function">FieldScoreQuery.Type</A></B></TD>
<TD>Type of score field, indicating how field values are interpreted/parsed.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/FloatFieldSource.html" title="class in org.apache.lucene.search.function">FloatFieldSource</A></B></TD>
<TD>Expert: obtains float field values from the 
 <A HREF="../../../../../org/apache/lucene/search/FieldCache.html" title="interface in org.apache.lucene.search"><CODE>FieldCache</CODE></A>
 using <code>getFloats()</code> and makes those values 
 available as other numeric types, casting as needed.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/IntFieldSource.html" title="class in org.apache.lucene.search.function">IntFieldSource</A></B></TD>
<TD>Expert: obtains int field values from the 
 <A HREF="../../../../../org/apache/lucene/search/FieldCache.html" title="interface in org.apache.lucene.search"><CODE>FieldCache</CODE></A>
 using <code>getInts()</code> and makes those values 
 available as other numeric types, casting as needed.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/OrdFieldSource.html" title="class in org.apache.lucene.search.function">OrdFieldSource</A></B></TD>
<TD>Expert: obtains the ordinal of the field value from the default Lucene 
 <A HREF="../../../../../org/apache/lucene/search/FieldCache.html" title="interface in org.apache.lucene.search"><CODE>Fieldcache</CODE></A> using getStringIndex().</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/ReverseOrdFieldSource.html" title="class in org.apache.lucene.search.function">ReverseOrdFieldSource</A></B></TD>
<TD>Expert: obtains the ordinal of the field value from the default Lucene 
 <A HREF="../../../../../org/apache/lucene/search/FieldCache.html" title="interface in org.apache.lucene.search"><CODE>FieldCache</CODE></A> using getStringIndex()
 and reverses the order.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/ShortFieldSource.html" title="class in org.apache.lucene.search.function">ShortFieldSource</A></B></TD>
<TD>Expert: obtains short field values from the 
 <A HREF="../../../../../org/apache/lucene/search/FieldCache.html" title="interface in org.apache.lucene.search"><CODE>FieldCache</CODE></A>
 using <code>getShorts()</code> and makes those values 
 available as other numeric types, casting as needed.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/ValueSource.html" title="class in org.apache.lucene.search.function">ValueSource</A></B></TD>
<TD>Expert: source of values for basic function queries.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../../../org/apache/lucene/search/function/ValueSourceQuery.html" title="class in org.apache.lucene.search.function">ValueSourceQuery</A></B></TD>
<TD>Expert: A Query that sets the scores of document to the
 values obtained from a <A HREF="../../../../../org/apache/lucene/search/function/ValueSource.html" title="class in org.apache.lucene.search.function"><CODE>ValueSource</CODE></A>.</TD>
</TR>
</TABLE>
&nbsp;

<P>
<A NAME="package_description"><!-- --></A><H2>
Package org.apache.lucene.search.function Description
</H2>

<P>
<DIV>
  Programmatic control over documents scores.
</DIV>
<DIV>
  The <code>function</code> package provides tight control over documents scores.
</DIV>
<DIV>
<font color="#FF0000">
WARNING: The status of the <b>search.function</b> package is experimental. The APIs
introduced here might change in the future and will not be supported anymore
in such a case.
</font>
</DIV>
<DIV>
  Two types of queries are available in this package:
</DIV>
<DIV>
  <ol>
     <li>
        <b>Custom Score queries</b> - allowing to set the score
        of a matching document as a mathematical expression over scores
        of that document by contained (sub) queries.
     </li>
     <li>
        <b>Field score queries</b> - allowing to base the score of a
        document on <b>numeric values</b> of <b>indexed fields</b>.
     </li>
  </ol>
</DIV>
<DIV>&nbsp;</DIV>
<DIV>
  <b>Some possible uses of these queries:</b>
</DIV>
<DIV>
  <ol>
     <li>
        Normalizing the document scores by values indexed in a special field -
        for instance, experimenting with a different doc length normalization.
     </li>
     <li>
        Introducing some static scoring element, to the score of a document, -
        for instance using some topological attribute of the links to/from a document.
     </li>
     <li>
        Computing the score of a matching document as an arbitrary odd function of
        its score by a certain query.
     </li>
  </ol>
</DIV>
<DIV>
  <b>Performance and Quality Considerations:</b>
</DIV>
<DIV>
  <ol>
     <li>
       When scoring by values of indexed fields,
       these values are loaded into memory.
       Unlike the regular scoring, where the required information is read from
       disk as necessary, here field values are loaded once and cached by Lucene in memory
       for further use, anticipating reuse by further queries. While all this is carefully
       cached with performance in mind, it is recommended to
       use these features only when the default Lucene scoring does
       not match your "special" application needs.
     </li>
     <li>
        Use only with carefully selected fields, because in most cases,
        search quality with regular Lucene scoring
        would outperform that of scoring by field values.
     </li>
     <li>
        Values of fields used for scoring should match.
        Do not apply on a field containing arbitrary (long) text.
        Do not mix values in the same field if that field is used for scoring.
     </li>
     <li>
        Smaller (shorter) field tokens means less RAM (something always desired).
        When using <a href=FieldScoreQuery.html>FieldScoreQuery</a>,
        select the shortest <a href=FieldScoreQuery.html#Type>FieldScoreQuery.Type</a>
        that is sufficient for the used field values.
     </li>
     <li>
        Reusing IndexReaders/IndexSearchers is essential, because the caching of field tokens
        is based on an IndexReader. Whenever a new IndexReader is used, values currently in the cache
        cannot be used and new values must be loaded from disk. So replace/refresh readers/searchers in
        a controlled manner.
     </li>
  </ol>
</DIV>
<DIV>
  <b>History and Credits:</b>
  <ul>
    <li>
       A large part of the code of this package was originated from Yonik's FunctionQuery code that was
       imported from <a href="http://lucene.apache.org/solr">Solr</a>
       (see <a href="http://issues.apache.org/jira/browse/LUCENE-446">LUCENE-446</a>).
    </li>
    <li>
       The idea behind CustomScoreQurey is borrowed from
       the "Easily create queries that transform sub-query scores arbitrarily" contribution by Mike Klaas
       (see <a href="http://issues.apache.org/jira/browse/LUCENE-850">LUCENE-850</a>)
       though the implementation and API here are different.
    </li>
  </ul>
</DIV>
<DIV>
 <b>Code sample:</b>
 <P>
 Note: code snippets here should work, but they were never really compiled... so,
 tests sources under TestCustomScoreQuery, TestFieldScoreQuery and TestOrdValues
 may also be useful.
 <ol>
  <li>
    Using field (byte) values to as scores:
    <p>
    Indexing:
    <pre>
      f = new Field("score", "7", Field.Store.NO, Field.Index.UN_TOKENIZED);
      f.setOmitNorms(true);
      d1.add(f);
    </pre>
    <p>
    Search:
    <pre>
      Query q = new FieldScoreQuery("score", FieldScoreQuery.Type.BYTE);
    </pre>
    Document d1 above would get a score of 7.
  </li>
  <p>
  <li>
    Manipulating scores
    <p>
    Dividing the original score of each document by a square root of its docid
    (just to demonstrate what it takes to manipulate scores this way)
    <pre>
      Query q = queryParser.parse("my query text");
      CustomScoreQuery customQ = new CustomScoreQuery(q) {
        public float customScore(int doc, float subQueryScore, float valSrcScore) {
          return subQueryScore / Math.sqrt(docid);
        }
      };
    </pre>
        <p>
        For more informative debug info on the custom query, also override the name() method:
        <pre>
      CustomScoreQuery customQ = new CustomScoreQuery(q) {
        public float customScore(int doc, float subQueryScore, float valSrcScore) {
          return subQueryScore / Math.sqrt(docid);
        }
        public String name() {
          return "1/sqrt(docid)";
        }
      };
    </pre>
        <p>
        Taking the square root of the original score and multiplying it by a "short field driven score", ie, the
        short value that was indexed for the scored doc in a certain field:
        <pre>
      Query q = queryParser.parse("my query text");
      FieldScoreQuery qf = new FieldScoreQuery("shortScore", FieldScoreQuery.Type.SHORT);
      CustomScoreQuery customQ = new CustomScoreQuery(q,qf) {
        public float customScore(int doc, float subQueryScore, float valSrcScore) {
          return Math.sqrt(subQueryScore) * valSrcScore;
        }
        public String name() {
          return "shortVal*sqrt(score)";
        }
      };
    </pre>

  </li>
 </ol>
</DIV>
<P>

<P>
<DL>
</DL>
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Package</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Class</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-use.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../../org/apache/lucene/search/package-summary.html"><B>PREV PACKAGE</B></A>&nbsp;
&nbsp;<A HREF="../../../../../org/apache/lucene/search/payloads/package-summary.html"><B>NEXT PACKAGE</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../../index.html?org/apache/lucene/search/function/package-summary.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="package-summary.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>
Copyright &copy; 2000-2010 Apache Software Foundation.  All Rights Reserved.
</BODY>
</HTML>
